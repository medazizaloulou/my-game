<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ - Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø©</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: url("khalfeya.jpg") no-repeat center center fixed;
  background-size: cover;
  color: white;
  text-align: center;
  padding-top: 50px;
  margin: 0;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: -1;
}

#box {
  width: 80px;
  height: 80px;
  background: red;
  position: absolute;
  display: none;
  cursor: pointer;
  border-radius: 10px;
}

#box:active {
  transform: scale(0.9);
  transition: 0.1s;
}

button {
  margin: 5px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

#timeBarContainer {
  width: 80%;
  height: 20px;
  background: #ddd;
  margin: 10px auto;
  border-radius: 10px;
}

#timeBar {
  height: 100%;
  width: 100%;
  background: red;
  border-radius: 10px;
}

/* ğŸ† Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© */
.high-score-box {
  position: fixed;
  top: 15px;
  right: 20px;
  font-size: 18px;
  font-weight: bold;
  background: linear-gradient(45deg, gold, orange);
  color: black;
  padding: 10px 18px;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
  transition: 0.3s;
}

.high-score-box.animate {
  transform: scale(1.2);
  box-shadow: 0 0 25px gold;
}

/* ğŸ“ Ù„ÙˆØ­Ø© Ø£Ø¹Ù„Ù‰ 5 Ù†Ù‚Ø§Ø· */
#leaderboard {
  position: fixed;
  top: 60px;
  right: 20px;
  width: 180px;
  background: rgba(0,0,0,0.6);
  border-radius: 10px;
  padding: 10px;
  text-align: left;
  font-size: 16px;
}

#leaderboard h3 {
  text-align: center;
  margin: 0 0 5px 0;
  font-size: 18px;
}
</style>
</head>

<body>

<p id="highScore" class="high-score-box">ğŸ† Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø©: 0</p>

<div id="leaderboard">
  <h3>ğŸ… Ø£ÙØ¶Ù„ 5</h3>
  <ol id="topScores"></ol>
</div>

<h1>ğŸ® Ø§Ù„Ø¹Ø¨ ÙÙˆØ±Ù‹Ø§</h1>
<p id="score">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</p>
<p id="timer">Ø§Ù„ÙˆÙ‚Øª: 30</p>

<div id="timeBarContainer">
  <div id="timeBar"></div>
</div>

<button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
<button id="restartBtn" style="display:none;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
<button id="stopBtn">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©</button>

<div id="box"></div>

<script>
// ===== Ø§Ù„Ø£ØµÙˆØ§Øª =====
let clickSound = new Audio("click.mp3");
let startSound = new Audio("start.mp3");

// ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª =====
let score = 0;
let speed = 2500;
let timeLeft = 30;
let totalTime = 30;
let gameRunning = false;
let timerInterval;
let boxTimeout;

// Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø¹Ø§Ù…Ø©
let highScore = localStorage.getItem("highScore") || 0;
let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

let box = document.getElementById("box");
let timeBar = document.getElementById("timeBar");
let highScoreElement = document.getElementById("highScore");
let topScoresElement = document.getElementById("topScores");

highScoreElement.innerText = "ğŸ† Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø©: " + highScore;
renderLeaderboard();

// ===== Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø¹ ØµÙˆØª =====
function startWithSound() {
  document.getElementById("startBtn").style.display = "none";
  startSound.currentTime = 0;
  startSound.play();

  setTimeout(() => {
    startGame();
  }, 4000);
}

// ===== Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© =====
function startGame() {
  score = 0;
  speed = 2500;
  timeLeft = totalTime;
  gameRunning = true;

  document.getElementById("score").innerText = "Ø§Ù„Ù†Ù‚Ø§Ø·: 0";
  document.getElementById("timer").innerText = "Ø§Ù„ÙˆÙ‚Øª: " + timeLeft;
  timeBar.style.width = "100%";

  document.getElementById("restartBtn").style.display = "inline-block";

  clearInterval(timerInterval);

  timerInterval = setInterval(() => {
    if (!gameRunning) return;
    timeLeft--;
    document.getElementById("timer").innerText = "Ø§Ù„ÙˆÙ‚Øª: " + timeLeft;
    timeBar.style.width = (timeLeft / totalTime * 100) + "%";

    if (timeLeft <= 0) endGame();
  }, 1000);

  showBox();
}

// ===== Ù„ÙˆÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠ =====
function getRandomColor() {
  let letters = "0123456789ABCDEF";
  let color = "#";
  for (let i=0;i<6;i++){
    color += letters[Math.floor(Math.random()*16)];
  }
  return color;
}

// ===== Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø±Ø¨Ø¹ =====
function showBox() {
  if (!gameRunning) return;

  let size = Math.random()*60 + 40;
  box.style.width = size + "px";
  box.style.height = size + "px";

  let x = Math.random()*(window.innerWidth - size);
  let y = Math.random()*(window.innerHeight - 200);

  box.style.left = x + "px";
  box.style.top = y + "px";

  box.style.background = getRandomColor();
  box.style.display = "block";

  boxTimeout = setTimeout(()=>{
    box.style.display="none";
    speed = 2500 - (score*20);
    if(speed < 1500) speed = 1500;
    showBox();
  }, speed);
}

// ===== Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· =====
box.onclick = function(){
  if(!gameRunning) return;
  clickSound.currentTime=0;
  clickSound.play();

  score++;
  document.getElementById("score").innerText = "Ø§Ù„Ù†Ù‚Ø§Ø·: "+score;

  box.style.display = "none";
  clearTimeout(boxTimeout);
  showBox();
}

// ===== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© =====
function endGame(){
  gameRunning=false;
  box.style.display="none";
  clearInterval(timerInterval);
  clearTimeout(boxTimeout);

  // ØªØ­Ø¯ÙŠØ« Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¬Ø¯ÙŠØ¯
  let newRecord=false;
  if(score > highScore){
    highScore = score;
    localStorage.setItem("highScore", highScore);
    highScoreElement.innerText = "ğŸ† Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø©: "+highScore;

    // âœ¨ ØªØ£Ø«ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ
    highScoreElement.classList.add("animate");
    setTimeout(()=>{highScoreElement.classList.remove("animate");},600);

    newRecord=true;
  }

  // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø£ÙØ¶Ù„ 5
  updateLeaderboard(score);

  if(newRecord){
    alert("ğŸ† Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¬Ø¯ÙŠØ¯!\nÙ†Ù‚Ø§Ø·Ùƒ: "+score);
  } else {
    alert("â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!\nÙ†Ù‚Ø§Ø·Ùƒ: "+score);
  }
}

// ===== Ù„ÙˆØ­Ø© Ø£Ø¹Ù„Ù‰ 5 Ù†Ù‚Ø§Ø· =====
function updateLeaderboard(score){
  leaderboard.push(score);
  leaderboard.sort((a,b)=>b-a); // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ
  if(leaderboard.length>5) leaderboard.pop(); // ÙÙ‚Ø· Ø£ÙØ¶Ù„ 5
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  renderLeaderboard();
}

// ===== Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø£ÙØ¶Ù„ 5 =====
function renderLeaderboard(){
  topScoresElement.innerHTML="";
  leaderboard.forEach((s,i)=>{
    let icon="";
    if(i==0) icon="ğŸ‘‘";
    else if(i==1) icon="ğŸ¥‡";
    else if(i==2) icon="ğŸ¥ˆ";
    else if(i==3) icon="ğŸ¥‰";
    else icon="â­";
    let li=document.createElement("li");
    li.innerText=icon + " " + s;
    topScoresElement.appendChild(li);
  });
}

// ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± =====
document.getElementById("startBtn").onclick=startWithSound;
document.getElementById("restartBtn").onclick=startWithSound;

document.getElementById("stopBtn").onclick=function(){
  if(!gameRunning) return;
  gameRunning=false;
  box.style.display="none";
  clearInterval(timerInterval);
  clearTimeout(boxTimeout);
  alert("ğŸ›‘ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©!\nÙ†Ù‚Ø§Ø·Ùƒ: "+score);
}
</script>
</body>
</html>
